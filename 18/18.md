# Level18 

For level18 **[balloons.jpg](/18/balloons.jpg)** is given. 

The bird in the picture is a Mute Swan. 


The picture consists of 2 swans, one on the left and one on the right. The one on the left seems to be a bit brighter than the one on the right.


The HTML title is `can you tell the difference?`.


There's also a HTML comment in the page source. 


```html
`<!-- it is more obvious that what you might think -->`
```


Now I'm stuck what does it mean `can you tell the difference?` so I searched for solutions online. 


The solution tells you to check the **brightness**.


Changing the URL to **[brightness](http://www.huge:file@pythonchallenge.com/pc/return/brightness.html)** works. 


There's another HTML comment in the page source. 


```html 
<!-- maybe consider deltas.gz -->
```

Changing the URL to **[deltas.gz](http://www.huge:file@pythonchallenge.com/pc/return/deltas.gz)** lets you download a file.


When running `file` on `deltas.gz`, it indeed is a `gzip` file. 


```bash 
file deltas.gz 
deltas.gz: gzip compressed data, was "delta.txt", last modified: Sat May  7 12:56:49 2005, from Unix, original size modulo 2^32 251944
```


I decompressed the gzip file to see what the archive was. 


```bash 
gzip -d deltas.gz
```


An ASCII text file pops up.


```bash
file deltas 
deltas: ASCII text
```


`deltas` is a text file separated vertically with columns of text on the right and left.


I pasted the first few lines of `deltas`. It looks like the data on the right and left are symmetrical to each other.

```
89 50 4e 47 0d 0a 1a 0a 00 00 00 0d 49 48 44 52 00 00   89 50 4e 47 0d 0a 1a 0a 00 00 00 0d 49 48 44 52 00 00
02 8a 00 00 00 c8 08 02 00 00 00 e0 19 57 95 00 00 00   02 8a 00 00 00 c8 08 02 00 00 00 e0 19 57 95 00 00 00
09 70 48 59 73 00 00 0b 13 00 00 0b 13 01 00 9a 9c 18   09 70 48 59 73 00 00 0b 13 00 00 0b 13 01 00 9a 9c 18
00 00 00 07 74 49 4d 45 07 d5 05 07 0c 18 32 98 c6 a0   00 00 00 07 74 49 4d 45 07 d5 05 07 0c 18 32 98 c6 a0
48 00 00 00 1d 74 45 58 74 43 6f 6d 6d 65 6e 74 00 43   48 00 00 00 1d 74 45 58 74 43 6f 6d 6d 65 6e 74 00 43
72 65 61 74 65 64 20 77 69 74 68 20 54 68 65 20 47 49   72 65 61 74 65 64 20 77 69 74 68 20 54 68 65 20 47 49
4d 50 ef 64 25 6e 00 00 20 00 49 44 41 54 78 da ec bd   4d 50 ef 64 25 6e 00 00 20 00 49 44 41 54 78 da ec bd
...
```

Until scrolling around to see if all of the columns on the right and left are identical I found this.

```
89 50 4e 47 0d 0a 1a 0a 00 00 00 0d 49 48 44 52 00 00   72 6c 41 7d 6b f7 bd a4 41 41 65 46 79 46 79 4f 6c d6
```


So the numbers on the right and left aren't the same. That's why the file was named [deltas](https://en.wikipedia.org/wiki/Delta_(letter)) and the HTML title was `can you tell the difference?`.


Unlike the *nix command `diff` I don't think Python has a module that shows you the difference between 2 things. 


Then I stumbled upon **[difflib](https://docs.python.org/3/library/difflib.html)** it's a built-in module to compare sequences.


According to the `difflib` module's documentation **[difflib.Differ](https://docs.python.org/3/library/difflib.html#difflib.Differ)** class is used for comparing sequences of lines of text and produces the differences.


`difflib.Differ` class has a **[compare](https://docs.python.org/3/library/difflib.html#difflib.Differ.compare)** method that compares two sequences of lines, and generates the delta.


Now we need to separate the numbers on the left column and the right column and save them separately.


To do that you need to find the exact index where the numbers on the left column ends.
Since the `len()` of the data on the left is `53` which means until the `52nd` index is the data on the left.


```python
print(len("89 50 4e 47 0d 0a 1a 0a 00 00 00 0d 49 48 44 52 00 00")) # 53
```


You can calculate the index for the data on the right the same way. since the data on the left and right are symmetrical for the first line, counting the spaces between the ending `00` on the left and starting `89` on the right will tell you the starting index on the right side. It's `56`.


Using Ipython will shows tells you the index easily. It's also great for getting the results without having to use the `print` function every time.


```python
print(len("89 50 4e 47 0d 0a 1a 0a 00 00 00 0d 49 48 44 52 00 00   89 50 4e 47 0d 0a 1a 0a 00 00 00 0d 49 48 44 52 00 00"))
```


Now that I've separated the data on the left and right, I can create a `difflib.Difflib` object and pass the data. Here's my code. 


```python
import difflib

d1,d2=[],[]
with open("deltas") as f: 
    for line in f:
        d1.append(line[:53]+"\n")
        d2.append(line[56:])


for diff in difflib.Differ().compare(d1,d2):
    print(diff)
```

The result looks like [this](/18/diff).


I brought just the few starting lines of the result.


```
- 31 91 3b d3 c5 a6 06 03 e6 98 10 af 76 50 8d a1 63 3a

+ ff dd 52 f8 73 44 70 b2 76 f8 97 69 c2 41 08 b8 cf 85

  99 e5 f6 e1 5b f8 1e f9 15 97 44 64 51 9b 26 ca ae 7d
```

Lines that start with a `-` are the lines unique to the data on the left, lines that start with a `+` are the lines unique to the data on the right,
lines that don't start with a `-` or `+` are lines common to data on both the left and right.


We should probably group lines starting with `-`, lines starting with `+`, and lines that don't start with either separately.


Another point when saving lines starting with `-`, `+` and lines that don't start with either is that `deltas.gz` is a binary file.


Binary files store **[bytes](https://docs.python.org/3/library/stdtypes.html#bytes-objects)**, which means we have to change data like `- 31 91 3b d3 c5 a6 06 03 e6 98 10 af 76 50 8d a1 63 3a` to bytes. 


I wrote code like this to get rid of `-` or `+` using `[2:]` then removed any spaces with `strip()` because there are lines like `4e 44 ae 42 60 82                                     ` in `deltas`, used `split()` to change the string to a `list` since we have an iterable of hexadecimal number **[bytes.fromhex](https://docs.python.org/3/library/stdtypes.html#bytes.fromhex)** neatly changes the hexadecimal strings to a byte-string.


```python
a="- 31 91 3b d3 c5 a6 06 03 e6 98 10 af 76 50 8d a1 63 3a"
print(bytes.fromhex("".join(a[2:].strip("").split(" ")))) # b'1\x91;\xd3\xc5\xa6\x06\x03\xe6\x98\x10\xafvP\x8d\xa1c:'
```


From here you just need to save the bytes-strings to 3 separate files. Files for saving lines starting with `-`, lines starting with `+` and and lines that don't start with either.


Here's the code that I wrote.


```python
import difflib

d1,d2=[],[]
with open("deltas") as f: 
    for line in f:
        d1.append(line[:53]+"\n")
        d2.append(line[56:])


for diff in difflib.Differ().compare(d1,d2):
    print(diff)


with (
    open("f1","wb") as f1,
    open("f2","wb") as f2,
    open("f3","wb") as f3
):
   
   for difference in difflib.Differ().compare(d1,d2):
       data=bytes.fromhex("".join(difference[2:].strip("").split(" ")))
       if difference.startswith("-"):
           f1.write(data)
       
       elif difference.startswith("+"):
           f2.write(data)
        
       else:
           f3.write(data)
```


Previously I wrote code like this. It was hard to read the code because I had to write the multiple `with open` statements in one line horizontally.


```python
with open('f1','wb') as f1 ,open('f2','wb') as f2, open('f3','wb') as f3:
```

Python 3.10 allows you to use **[Parenthesized context managers](https://docs.python.org/3/whatsnew/3.10.html#parenthesized-context-managers)**.
The code is much organized and it's easy to grasp what you're trying to do.


```python
with (
    open("f1","wb") as f1,
    open("f2","wb") as f2,
    open("f3","wb") as f3
):
```


For more information you can check out the book **[Fluent Python](https://www.amazon.com/dp/1492056359/ref=sr_1_1?sr=8-1)** p663.


Let's check out the 3 generated files.


All of the 3 files are `png` image files.


```bash 
file f1 f2 f3
f1: PNG image data, 336 x 143, 8-bit/color RGBA, non-interlaced
f2: PNG image data, 336 x 143, 8-bit/color RGBA, non-interlaced
f3: PNG image data, 650 x 200, 8-bit/color RGB, non-interlaced
```


You can move the files to a `*.png` file with `mv` but since I'm lazy let's use some bash-scripting.


```bash 
for file in f1 f2 f3; do
    mv "$file" "$file.png"
done
```


Now we can see what the images look like. 


The first image look's like [this](/18/f1.png). The word **fly** is written in green.


The second image look's like [this](/18/f2.png). The word ***butter** is written in red.


The third image look's like [this](/18/f3.png). It's not a word `../hex/bin.html` is written in purple. 


Aha so I'm guessing that `../hex/bin.html` is the URL for the next level and `fly` , `butter` must be the authentication for the web page.


So changing the URL from http://www.huge:file@pythonchallenge.com/pc/return/brightness.html to  http://www.butter:fly@pythonchallenge.com/pc/hex/bin.html 
takes you to level19. 


The username is `butter` and the password is `fly`. You might get it wrong because entering `fly` for the username and `butter` for the password will not work although that's the order python challenge gave you in the first-place meh.


I wrote my Python script after unzipping the gzip file using `gzip -d` if you directly want to work on `deltas.gz` you can use the built-in **[gzip](https://docs.python.org/3/library/gzip.html)** module right away. **[gzip.open](https://docs.python.org/3/library/gzip.html#gzip.open)** decompress the gzip file.


From there it's pretty much the same but you just have to decode the bytes in `deltas.gz` to a string. 


You can check out the code that starts without deflating `deltas.gz` **[here](/18/18-1.py)**


Changing a `bytes` object to a `str` is relatively simple but understanding what's going on under the hood is actually pretty complex and to be honest I'm not someone who can explain it a 100% accurately.


So If you're interested in what `bytes` are and what `bytes.decode` does what exactly is UTF-8 read the links below.


1\. **[bytes vs strings](https://realpython.com/python-bytes/#getting-to-know-the-bytes-object-in-python)**


2\. **[bytes.decode](https://docs.python.org/3/library/stdtypes.html#bytes.decode)**


3\. **[UTF-8](https://en.wikipedia.org/wiki/UTF-8)**  


I personally enjoyed this level other than the part where I needed to change the URL to `brightness` level18 was pretty doable. 